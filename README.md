# gavrilovv
Чат-бот ВКонтакте для отправки анонимных комментариев. Также является пакетом npm.

Доступ к API проводится через модуль [vk-io](https://github.com/negezor/vk-io) с использованием [vk-io-question](https://github.com/fakemancat/vk-io-question), [@vk-io/hear](https://github.com/negezor/vk-io/blob/master/packages/hear), [form-data](https://github.com/form-data/form-data).

## Фичи
* Отправка анонимных комментариев на стену.
* Обращение с API ВКонтакте с авторизацией через токен сообщества (и пользователя).
* Поддержка вложений аудио, видео, файлов (фото - с токеном пользователя).
* Поддержка ссылок и вложений в роли цели сообщения.
* Чат-интерфейс через сообщения сообщества.
* Настройка инициализирующего слова (регулярного выражения) бота - поле triggerWord в файле реплик. Строка ищется во всём сообщении, игнорируя регистр.
* Изменение реплик бота через замену JSON-файла (в конфиге или напрямую). Примеры находятся в [responses_ru.json](./responses_ru.json) и [responses_en.json](./responses_en.json).
* Запись запросов в лог (stdout по умолчанию).
* Поддержка *списка допустимых сообществ* (whitelist).
* Фильтрация URL-ссылок в сообщениях для избежания спама.
* Конфигурация whitelist, логгинга и фильтрации ссылок через [config.json](./config.json) и переменные среды.

## Конфигурация
### Файл реплик
```
triggerWord        - Слово, найдя которое в сообщении (регулярное выражение без флагов), бот начнёт запрашивать комментарий.
getDestination     - Запрос места назначения комментария.
postNotFound       - Ответ, выдающийся при отсутствии нужного поста.
invalidDestination - Ответ, выдающийся при отсутствии сообщества в белом списке.
getMessage         - Запрос комментария с вложениями.
messageSent        - Ответ, означающий успешную отправку комментария.
scriptError        - Ответ, обозначающий ошибку. Сама ошибка выводится в лог.
```
### config.json
```
responsesFile - Путь к файлу реплик.
logRequests   - Запись запросов в лог. По умолчанию true.
filterSources - Поддержка допусимых сообществ (whitelist). По умолчанию true.
filterLinks   - Фильтрация ссылок в сообщениях. По умолчанию true.
```
### Переменные среды
```
GROUP_ID  - ID группы, от лица которой отправляются сообщения. Положительное целое число.
TOKEN     - Токен сообщества от API ВК. Требуются права на доступ к сообщениям сообщества и документам.
UTOKEN    - Токен пользователя от API ВК. Требуются права на доступ к фотографиям.
WHITELIST - Список сообществ, куда допускается отправлять сообщения. Не требуется если свойство filterSources равно false.
```


